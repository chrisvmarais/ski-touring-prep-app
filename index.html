<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ski Touring Prep Training</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .workout-card { cursor: pointer; transition: all 0.2s; }
        .workout-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .completed { background-color: #f0f9ff; border-color: #22c55e; }
        .modal { backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app" class="max-w-4xl mx-auto p-6 min-h-screen">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">Ski Touring Prep Training</h1>
                    <p class="text-gray-600">Cascade Endurance • 100mile Kyle • Mountainfit</p>
                </div>
                <div class="text-4xl">🎿</div>
            </div>
            <div class="mt-4 flex items-center justify-between flex-wrap gap-2">
                <div class="flex items-center space-x-4">
                    <div id="phase-badge" class="bg-blue-500 text-white px-4 py-2 rounded-full text-sm font-medium">
                        Week 1: Base Building
                    </div>
                    <div id="completion-rate" class="text-sm text-gray-600">Completion: 0%</div>
                </div>
                <button onclick="resetProgress()" class="text-xs text-gray-500 hover:text-gray-700 underline">
                    Reset Progress
                </button>
            </div>
        </div>

        <!-- Week Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Training Week</h2>
                <div class="flex space-x-2">
                    <button onclick="changeWeek(-1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Previous</button>
                    <span id="current-week" class="px-4 py-1 bg-blue-100 rounded font-medium">Week 1</span>
                    <button onclick="changeWeek(1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next</button>
                </div>
            </div>
            <div id="phase-description" class="text-sm text-gray-600">
                Focus: Skinning pace aerobic base, single-leg strength foundation, fascial preparation
            </div>
        </div>

        <!-- Workout Schedule -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-semibold mb-4">This Week's Training</h3>
            <div id="workout-grid" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                <!-- Workouts populated by JavaScript -->
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center text-sm text-gray-500">
            <p>Your personalized ski touring preparation program</p>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center p-4 z-50 modal">
        <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="modal-title" class="text-2xl font-bold text-gray-800"></h3>
                    <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">×</button>
                </div>
                
                <div id="modal-content"></div>
                
                <div class="flex justify-between items-center pt-4 border-t mt-6 flex-wrap gap-2">
                    <button onclick="closeModal()" class="px-4 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                        Close
                    </button>
                    <div class="flex space-x-2">
                        <button id="add-to-calendar-btn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm">
                            📅 Add to Calendar
                        </button>
                        <button id="complete-btn" class="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                            Mark Complete ✓
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentWeek = 1;
        let completedWorkouts = new Set();
        let selectedWorkout = null;

        // Load saved data
        function loadSavedData() {
            try {
                const savedWeek = localStorage.getItem('skiTouringCurrentWeek');
                const savedCompleted = localStorage.getItem('skiTouringCompletedWorkouts');
                
                if (savedWeek) currentWeek = parseInt(savedWeek);
                if (savedCompleted) completedWorkouts = new Set(JSON.parse(savedCompleted));
            } catch (e) {
                console.log('Storage not available');
            }
        }

        // Save data
        function saveData() {
            try {
                localStorage.setItem('skiTouringCurrentWeek', currentWeek.toString());
                localStorage.setItem('skiTouringCompletedWorkouts', JSON.stringify([...completedWorkouts]));
            } catch (e) {
                console.log('Storage not available');
            }
        }

        // Training phases
        function getPhase(week) {
            if (week <= 4) return { name: "Base Building", color: "bg-blue-500" };
            if (week <= 8) return { name: "Aerobic Development", color: "bg-green-500" };
            if (week <= 12) return { name: "Strength & Power", color: "bg-orange-500" };
            return { name: "Peak & Taper", color: "bg-purple-500" };
        }

        // Base workout templates
        const baseWorkouts = {
            week1: {
                'Monday': {
                    type: 'Rest & Mobility',
                    workout: 'Rest Day Recovery + Hip/Ankle Mobility',
                    duration: 30,
                    warmup: "5min gentle walk or easy movement to assess how body feels from weekend training",
                    main: [
                        "Hip Mobility Sequence:",
                        "• 90/90 hip stretches: 2x60sec each side (internal + external rotation)",
                        "• Pigeon pose: 2x60sec each side (deep hip flexor and glute stretch)",
                        "• Hip circles: 10 each direction, both legs",
                        "• Frog stretch: 2x45sec (groin and inner hip mobility)",
                        "• Couch stretch: 2x60sec each side (deep hip flexor)",
                        "Ankle Mobility:",
                        "• Ankle circles: 20 each direction, both ankles",
                        "• Calf stretches (straight leg): 3x30sec each",
                        "• Calf stretches (bent knee): 3x30sec each (soleus focus)",
                        "Light foam rolling: IT band, quads, calves (8min)",
                        "Gentle spinal twists: 5 each direction",
                        "Deep breathing: 3min relaxation"
                    ],
                    cooldown: "Complete rest - this IS your recovery day"
                },
                'Tuesday': {
                    type: 'Gym Training',
                    workout: 'Step-ups + Pull-ups + Single-leg Foundation',
                    duration: 60,
                    warmup: "10min dynamic: 1min march → 20 arm circles each direction → 10 leg swings each leg (front/back) → 10 leg swings (side to side) → 8 walking lunges → 6 side squats with curtsy lunge each side → 8 bodyweight squats → 10 lateral hops (5 each direction) → 30sec easy step-ups each leg",
                    main: [
                        "Weighted step-ups 18-24\": 3x12 each leg (10-15lb pack)",
                        "Pull-ups or assisted: 4x5-8 reps",
                        "Single-leg glute bridges: 3x10 each side",
                        "Bulgarian split squats: 3x8 each leg",
                        "Plank: 3x30-45 seconds",
                        "Face pulls: 2x15 (shoulder health)"
                    ],
                    cooldown: "Hip flexor stretch, calf stretch, upper back stretch, 5min walk"
                },
                'Wednesday': {
                    type: 'Trail Run',
                    workout: 'Skinning Pace Base Build',
                    duration: 60,
                    warmup: "15min progressive: 3min flat easy running → 2min slight incline → 8 side squats with curtsy lunge → 10 lateral hops each direction → 1min moderate incline → 30sec faster → back to easy × 2 rounds → 2min at target pace",
                    main: [
                        "60min steady trail run (uphill focus)",
                        "Target: nose breathing only (conversational pace)",
                        "Simulate skinning rhythm: 60-70 steps/min",
                        "Focus on efficient uphill technique"
                    ],
                    cooldown: "5min easy walk/jog, dynamic stretching, hydrate"
                },
                'Thursday': {
                    type: 'Gym Training',
                    workout: 'Jump Prep + Eccentric Loading + Rows',
                    duration: 55,
                    warmup: "12min progressive: 2min walk → 10 arm swings each direction → 8 bodyweight squats → 6 walking lunges each leg → 8 side squats with curtsy lunge each side → 10 calf raises → 10 lateral hops (5 each direction) → 5 small hops → 5 step-ups each leg → 30sec marching",
                    main: [
                        "Box steps (controlled): 3x8 each leg",
                        "Eccentric squats (3sec down): 3x8",
                        "Bent-over rows: 3x10",
                        "Nordic hamstring curls (assisted): 3x3-5",
                        "Jump prep: Small hops 2x10",
                        "Overhead press: 3x8"
                    ],
                    cooldown: "Quad stretch, hamstring stretch, shoulder stretch, foam roll"
                },
                'Friday': {
                    type: 'Optional Run',
                    workout: 'Optional Easy Run + Mobility Flow',
                    duration: 45,
                    warmup: "If running: 8min easy build. If mobility: 5min gentle movement",
                    main: [
                        "OPTION A: 30min easy recovery run + 15min mobility",
                        "OPTION B: 45min comprehensive mobility",
                        "Hip Mobility: Hip flexor stretches 3x45sec, Figure-4 2x45sec, Hip circles 10 each",
                        "Shoulder Mobility: Wall slides 3x10, Doorway pec stretch 2x45sec, Band pull-aparts 2x15, Thread the needle 2x30sec",
                        "Prepare body for Saturday adventure"
                    ],
                    cooldown: "Complete relaxation"
                },
                'Saturday': {
                    type: 'Long Adventure',
                    workout: 'Long Trail Run/Ski',
                    duration: 200,
                    warmup: "15min progressive with pack: easy → build intensity → practice target pace",
                    main: [
                        "3-4hr continuous trail running/skiing with pack",
                        "Week 1-2: 10-15lbs, Week 3-4: 15-20lbs",
                        "Mix terrain: uphills, flats, technical sections",
                        "Practice nutrition every 45-60min",
                        "Focus on sustainable pacing"
                    ],
                    cooldown: "20min walk cool-down, comprehensive stretching, refuel"
                },
                'Sunday': {
                    type: 'Recovery',
                    workout: 'Optional Easy Run + Deep Recovery',
                    duration: 60,
                    warmup: "If running: 5min very easy. If recovery: gentle assessment",
                    main: [
                        "OPTION A: 30-45min very easy recovery run + 30min recovery work",
                        "OPTION B: 60min full recovery protocol",
                        "Recovery focus: foam rolling, stretching, fascial release",
                        "Listen to your body - complete rest if needed"
                    ],
                    cooldown: "Complete rest, prepare for week ahead"
                }
            }
        };

        // Generate schedule based on week and phase
        function generateSchedule(week) {
            const base = JSON.parse(JSON.stringify(baseWorkouts.week1));
            
            // Adjust Saturday duration progressively
            if (week <= 4) {
                base.Saturday.duration = 180 + (week * 20);
                base.Saturday.main[0] = `${3 + week * 0.25}hr continuous trail with ${10 + (week * 2.5)}lb pack`;
            } else if (week <= 8) {
                base.Saturday.duration = 240 + ((week - 4) * 15);
                base.Saturday.main[0] = `${4 + (week - 4) * 0.25}hr continuous with ${15 + ((week - 4) * 2.5)}lb pack`;
                base.Tuesday.main[0] = `Weighted step-ups: 4x10 each leg (${15 + ((week - 4) * 2.5)}lb pack)`;
            } else if (week <= 12) {
                base.Saturday.duration = 330 + ((week - 8) * 7);
                base.Saturday.main[0] = `${5.5 + (week - 8) * 0.125}hr peak volume with ${20 + ((week - 8) * 2.5)}lb pack`;
            } else {
                base.Saturday.duration = 180;
                base.Saturday.main[0] = "3hr moderate adventure with 15-20lb pack (taper)";
            }
            
            // Convert to array
            const schedule = [];
            Object.entries(base).forEach(([day, workout]) => {
                schedule.push({ day, ...workout });
            });
            
            return schedule;
        }

        // Get emoji for workout type
        function getIcon(type) {
            const icons = {
                'Rest & Mobility': '🧘‍♂️',
                'Gym Training': '💪',
                'Trail Run': '🏃‍♂️',
                'Optional Run': '🤸‍♂️',
                'Long Adventure': '⛰️',
                'Recovery': '😌'
            };
            return icons[type] || '🎿';
        }

        // Render workouts
        function renderWorkouts() {
            const schedule = generateSchedule(currentWeek);
            const grid = document.getElementById('workout-grid');
            
            grid.innerHTML = schedule.map(workout => {
                const workoutId = `${currentWeek}-${workout.day}`;
                const isCompleted = completedWorkouts.has(workoutId);
                
                return `
                    <div class="workout-card border rounded-lg p-4 ${isCompleted ? 'completed border-green-200' : 'border-gray-200'}" 
                         onclick="openModal('${workout.day}')">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-2">
                                <span class="text-lg">${getIcon(workout.type)}</span>
                                <span class="font-medium text-gray-700">${workout.day}</span>
                            </div>
                            <button onclick="toggleCompletion(event, '${workoutId}')" class="text-green-600 hover:text-green-700">
                                ${isCompleted ? '✅' : '⭕'}
                            </button>
                        </div>
                        
                        <h4 class="font-semibold text-gray-800 mb-2">${workout.workout}</h4>
                        <p class="text-sm text-gray-600 mb-3">${workout.type}</p>
                        
                        <div class="flex items-center text-sm text-gray-500 mb-4">
                            <span class="mr-1">⏱️</span>
                            ${workout.duration} min
                        </div>
                        
                        <div class="mt-4 pt-3 border-t border-gray-200">
                            <div class="flex items-center justify-center space-x-2 text-blue-600 font-medium">
                                <span>▶️</span>
                                <span>Tap for Full Details</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle completion
        function toggleCompletion(event, workoutId) {
            event.stopPropagation();
            if (completedWorkouts.has(workoutId)) {
                completedWorkouts.delete(workoutId);
            } else {
                completedWorkouts.add(workoutId);
            }
            saveData();
            updateUI();
        }

        // Change week
        function changeWeek(direction) {
            currentWeek = Math.max(1, currentWeek + direction);
            saveData();
            updateUI();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('Reset all progress? This cannot be undone.')) {
                currentWeek = 1;
                completedWorkouts.clear();
                saveData();
                updateUI();
            }
        }

        // Add to calendar
        function addToCalendar(day, workout) {
            const today = new Date();
            const dayIndex = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'].indexOf(day);
            const currentDayIndex = today.getDay();
            
            let daysUntilWorkout = dayIndex - currentDayIndex;
            if (daysUntilWorkout <= 0) daysUntilWorkout += 7;
            
            const workoutDate = new Date();
            workoutDate.setDate(today.getDate() + daysUntilWorkout);
            
            const workoutTimes = {
                'Rest & Mobility': { hour: 9, minute: 0 },
                'Gym Training': { hour: 18, minute: 0 },
                'Trail Run': { hour: 7, minute: 0 },
                'Optional Run': { hour: 17, minute: 0 },
                'Long Adventure': { hour: 8, minute: 0 },
                'Recovery': { hour: 10, minute: 0 }
            };
            
            const time = workoutTimes[workout.type] || { hour: 9, minute: 0 };
            workoutDate.setHours(time.hour, time.minute, 0, 0);
            
            const endDate = new Date(workoutDate);
            endDate.setMinutes(endDate.getMinutes() + workout.duration);
            
            const formatDate = (date) => {
                return date.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };
            
            const eventDetails = {
                title: `${day}: ${workout.workout}`,
                start: formatDate(workoutDate),
                end: formatDate(endDate),
                description: `Week ${currentWeek} Training\\n\\nWarm-up: ${workout.warmup}\\n\\nMain: ${workout.main.join(', ')}\\n\\nCool-down: ${workout.cooldown}`,
                location: workout.type.includes('Gym') ? 'Gym' : workout.type.includes('Trail') ? 'Trail/Outdoors' : 'Home/Flexible'
            };
            
            const calendarUrl = `https://calendar.google.com/calendar/render?action=TEMPLATE&` +
                `text=${encodeURIComponent(eventDetails.title)}&` +
                `dates=${eventDetails.start}/${eventDetails.end}&` +
                `details=${encodeURIComponent(eventDetails.description)}&` +
                `location=${encodeURIComponent(eventDetails.location)}`;
            
            window.open(calendarUrl, '_blank');
        }

        // Open modal
        function openModal(day) {
            const schedule = generateSchedule(currentWeek);
            selectedWorkout = schedule.find(w => w.day === day);
            
            if (!selectedWorkout) return;
            
            document.getElementById('modal-title').textContent = `${day} - ${selectedWorkout.workout}`;
            
            const content = `
                <div class="flex items-center space-x-4 text-sm text-gray-600 mb-6">
                    <div><span class="mr-1">⏱️</span>${selectedWorkout.duration} minutes</div>
                    <div><span class="mr-1">${getIcon(selectedWorkout.type)}</span>${selectedWorkout.type}</div>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-blue-800 mb-2">Warm-up</h4>
                    <p class="text-blue-700 whitespace-pre-line">${selectedWorkout.warmup}</p>
                </div>

                <div class="bg-orange-50 p-4 rounded-lg mb-6">
                    <h4 class="font-semibold text-orange-800 mb-3">Main Workout</h4>
                    <div class="space-y-1 text-orange-700">
                        ${selectedWorkout.main.map(exercise => `<div>${exercise}</div>`).join('')}
                    </div>
                </div>

                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">Cool-down</h4>
                    <p class="text-green-700">${selectedWorkout.cooldown}</p>
                </div>
            `;
            
            document.getElementById('modal-content').innerHTML = content;
            document.getElementById('complete-btn').onclick = () => markCompleteAndClose(day);
            document.getElementById('add-to-calendar-btn').onclick = () => addToCalendar(day, selectedWorkout);
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }

        // Close modal
        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
            selectedWorkout = null;
        }

        // Mark complete and close
        function markCompleteAndClose(day) {
            const workoutId = `${currentWeek}-${day}`;
            if (completedWorkouts.has(workoutId)) {
                completedWorkouts.delete(workoutId);
            } else {
                completedWorkouts.add(workoutId);
            }
            saveData();
            updateUI();
            closeModal();
        }

        // Update UI
        function updateUI() {
            const phase = getPhase(currentWeek);
            
            document.getElementById('current-week').textContent = `Week ${currentWeek}`;
            document.getElementById('phase-badge').textContent = `Week ${currentWeek}: ${phase.name}`;
            document.getElementById('phase-badge').className = `${phase.color} text-white px-4 py-2 rounded-full text-sm font-medium`;
            
            const descriptions = {
                "Base Building": "Focus: Skinning pace aerobic base, single-leg strength foundation, fascial preparation",
                "Aerobic Development": "Focus: Long day endurance, weighted step-ups, plyometric preparation, back-to-back sessions",
                "Strength & Power": "Focus: Drop jump readiness, multi-plane power, peak long days (5-6+ hours), impact preparation",
                "Peak & Taper": "Focus: Maintaining fitness while preparing legs/fascia for touring season demands"
            };
            document.getElementById('phase-description').textContent = descriptions[phase.name];
            
            const schedule = generateSchedule(currentWeek);
            const completedThisWeek = schedule.filter(w => completedWorkouts.has(`${currentWeek}-${w.day}`)).length;
            const completionRate = Math.round((completedThisWeek / schedule.length) * 100);
            document.getElementById('completion-rate').textContent = `Completion: ${completionRate}%`;
            
            renderWorkouts();
        }

        // Initialize
        function init() {
            loadSavedData();
            updateUI();
        }

        init();
    </script>
</body>
</html>
